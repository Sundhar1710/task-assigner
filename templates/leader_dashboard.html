<!DOCTYPE html> 
<html>
<head>
    <title>Leader Dashboard</title> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='leader.css') }}"> 
</head>
<body>
    {% if error %}
        <div class="alert alert-warning" role="alert">{{ error }}</div>
    {% endif %}

    <h1>💼 Leader Dashboard</h1>
    <div class="top-bar">
        <a href="/add_task">➕ Add New Task</a>
        <a href="{{ url_for('leader_logout') }}" class="logout-btn">🔒 Logout</a>
    </div>

    <!-- Sorting Form -->
    <form method="get" action="{{ url_for('leader_dashboard') }}" class="sort-form">
        <label for="sort_by"><b>Sort By:</b></label>
        <select name="sort_by" id="sort_by" onchange="this.form.submit()">
            <option value="">-- Select --</option>
            <option value="pending" {% if request.args.get('sort_by') == 'pending' %}selected{% endif %}>Status Pending</option>
            <option value="completed" {% if request.args.get('sort_by') == 'completed' %}selected{% endif %}>Status Completed</option>
            <option value="old" {% if request.args.get('sort_by') == 'old' %}selected{% endif %}>Date Created (Near First)</option>
            <option value="new" {% if request.args.get('sort_by') == 'new' %}selected{% endif %}>Date Created (Long First)</option>
        </select>
    </form>

    <a href="{{ url_for('leader_analysis') }}" class="btn-team-details">👥 Team Details</a>
    <!-- Tasks Table -->
    <table border="1" cellpadding="8">
        <thead>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Email</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task[1] }}</td>
                <td>{{ task[2] or '—' }}</td>
                <td>{{ task[3] }}</td>
                <td>{{ task[4] }}</td>
                <td>{{ task[6] }}</td>
                <td>{{ task[5] }}</td>
                <td>
                    <a href="/edit_task/{{ task[0] }}">✏️ Edit</a> |
                    <a href="/delete_task/{{ task[0] }}" onclick="return confirm('Are you sure?')">🗑️ Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Reload fix on back navigation
        window.addEventListener("pageshow", function (event) {
            if (event.persisted || (window.performance && window.performance.getEntriesByType("navigation")[0].type === "back_forward")) {
                window.location.reload();
            }
        });

        setTimeout(() => {
            document.querySelector('.alert').remove();
        }, 3000);
    </script>
</body>
</html>
