<!DOCTYPE html>
<html>
<head>
    <title>Member Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='member.css') }}">

</head>
<body>
    <h2 style="text-align:center;">Welcome, {{ member_email }}</h2>
    <h3 style="text-align:center;">Your Assigned Tasks</h3>

    <div class="logout-container">
    <a href="{{ url_for('member_logout') }}" class="logout-btn">ðŸ”’ Logout</a>
    </div>

    <form method="get" action="{{ url_for('member_dashboard') }}" class="sort-form">
            <label for="sort_by"><b>Sort By:</b></label>
            <select name="sort_by" id="sort_by" onchange="this.form.submit()">
                <option value="">-- Select --</option>
                <option value="pending" {% if request.args.get('sort_by') == 'pending' %}selected{% endif %}>Status Pending</option>
                <option value="completed" {% if request.args.get('sort_by') == 'completed' %}selected{% endif %}>Status Completed</option>
                <option value="old" {% if request.args.get('sort_by') == 'old' %}selected{% endif %}>Due Date (Oldest First)</option>
                <option value="new" {% if request.args.get('sort_by') == 'new' %}selected{% endif %}>Due Date (Newest First)</option>
            </select>
    </form>
    {% if tasks and tasks|length > 0 %}
        <table>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Assigned By</th>
                <th>Action</th>
            </tr>
            {% for task in tasks %}
            <tr>
                <td>{{ task[0] }}</td>
                <td>{{ task[1] }}</td>
                <td>{{ task[2] }}</td>
                <td>{{ task[3] }}</td>
                <td>{{ task[4] }}</td>
                <td>
                    {% if task[3] != 'complete' %}
                        <form action="{{ url_for('complete_task') }}" method="POST">
                            <input type="hidden" name="title" value="{{ task[0] }}">
                            <input type="hidden" name="email" value="{{ member_email }}">
                            <button class="btn" type="submit">Mark Complete</button>
                        </form>
                    {% else %}
                        <button class="btn" disabled>âœ… Completed</button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <img src="{{ url_for('static', filename='task-image.webp') }}" 
                alt="No tasks available"
                style="width:300px; height:auto; margin-bottom: 1px;">
            
            <p style="font-weight:bold; font-size: 34px; color:gray;">
                You donâ€™t have any tasks assigned yet.
            </p>
        </div>

    {% endif %}
    <script>
        window.addEventListener("pageshow", function (event) {
            if (event.persisted || (window.performance && window.performance.getEntriesByType("navigation")[0].type === "back_forward")) {
                window.location.reload();
            }
        });
    </script>
</body>
</html>
