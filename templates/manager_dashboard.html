<!DOCTYPE html>
<html>
<head>
    <title>Manager Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{url_for('static', filename = 'manager.css')}}">
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, msg in messages %}
                <div class="alert alert-{{ category }}">{{ msg }}</div>
            {% endfor %}
        {% endif %}
{% endwith %}

    <h2>Welcome, {{ session.manager_email }}</h2>
<!-- Create + Logout buttons in one row -->
<div class="top-bar">
    <a href="{{ url_for('create_team') }}">+ Create New Team</a>
    <a class="logout" href="{{ url_for('manager_logout') }}">🔒 Logout</a>
</div>

<!-- Sorting Form below Create Team -->
<form method="get" action="{{ url_for('managers_dashboard') }}" class="sort-form">
    <label for="sort_by"><b>Sort By:</b></label>
    <select name="sort_by" id="sort_by" onchange="this.form.submit()">
        <option value="">-- Select --</option>
        <option value="email_a" {% if request.args.get('sort_by') == 'email_a' %}selected{% endif %}>Leader Email (A-Z)</option>
        <option value="date_new" {% if request.args.get('sort_by') == 'date_new' %}selected{% endif %}>Date Created (Newest First)</option>
        <option value="date_old" {% if request.args.get('sort_by') == 'date_old' %}selected{% endif %}>Date Created (Oldest First)</option>
        <option value="email_z" {% if request.args.get('sort_by') == 'email_z' %}selected{% endif %}>Leader Email (Z-A)</option>
    </select>
</form>

    {% if teams and teams|length > 0 %}
        <table border="1" cellpadding="5">
            <tr>
                <th>Team ID</th>
                <th>Leader Email</th>
                <th>Created At</th>
                <th>Action</th>
                <th>Details</th>
                <th>Delete</th>
            </tr>
            {% for t in teams %}
            <tr>
                <td>{{ t[1] }}</td>
                <td>{{ t[2] }}</td>
                <td>{{ t[4] }}</td>
                <td><a href="{{ url_for('edit_team', team_id=t[1]) }}">✏️ Edit</a></td>
                <td><a href="{{ url_for('analysis', team_id=t[1]) }}">➡️</a></td>
                <td><a href="{{ url_for('delete_team', team_id=t[1]) }}"
            onclick="return confirm('Are you sure you want to delete this team? This action cannot be undone.');">
            🗑️ Delete
            </a></td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <img src="{{ url_for('static', filename='manager-image.webp') }}" 
                alt="No tasks available"
                style="width:300px; height:auto; margin-bottom: 1px;">
            
            <p style="font-weight:bold; font-size: 34px; color:gray;">
                You haven’t created a team yet.
            </p>
        </div>
    {% endif %}
    <script>
        window.addEventListener("pageshow", function (event) {
            if (event.persisted || (window.performance && window.performance.getEntriesByType("navigation")[0].type === "back_forward")) {
                window.location.reload();
            }
        });
        setTimeout(() => {document.querySelector('.alert').remove();}, 3000);
    </script>
</body>
</html>
