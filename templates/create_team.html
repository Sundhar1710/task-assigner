<!DOCTYPE html>
<html>
<head>
    <title>Create Team</title>
    <link rel="stylesheet" href="{{url_for('static', filename='create_team.css')}}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, msg in messages %}
                <div class="alert alert-{{ category }}">{{ msg }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h2>Create New Team</h2>
    <form method="POST" id="teamForm">
        <label>Leader Email:</label><br>
        <input type="email" name="leader_email" required><br><br>
        <label>Members Email:</label>
        <div id="memberFields">
            <input type="email" name="member_email" placeholder="Member Email" required>
        </div>
        <br>
        <button type="button" onclick="addMemberField()">+ Add Another Member</button>
        <br><br>
        <input type="submit" value="Create Team">
    </form>

    <div id="loading-message">
        <div class="text-center">
            <div class="spinner-border text-light" role="status"></div>
            <p class="mt-3">Sending mails to members and leader...</p>
        </div>
    </div>

    
    <script>
        window.addEventListener("pageshow", function (event) {
            if (event.persisted || (window.performance && window.performance.getEntriesByType("navigation")[0].type === "back_forward")) {
                window.location.reload();
            }
        });
        function addMemberField() {
            let div = document.getElementById("memberFields");
            let input = document.createElement("input");
            input.type = "email";
            input.name = "member_email";
            input.placeholder = "Member Email";
            div.appendChild(document.createElement("br"));
            div.appendChild(input);
        }
        setTimeout(() => {document.querySelector('.alert').remove();}, 3000);

        document.getElementById("teamForm").addEventListener("submit", function(event) {
            event.preventDefault(); // stop immediate navigation
            document.getElementById("loading-message").style.display = "flex";
            setTimeout(() => {
                    event.target.submit();
                }, 200); 
        });
    </script>
</body>
</html>


<!--#loading-message
{
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    margin-top: 20px;
} -->